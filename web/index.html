<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Abby Unleashed Mobile</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root {
            --primary: #6366f1; --success: #10b981; --error: #ef4444;
            --bg: #0f172a; --surface: #1e293b; --text: #f1f5f9;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg); color: var(--text);
            height: 100vh; display: flex; flex-direction: column;
        }
        .header {
            background: var(--surface); padding: 1rem;
            display: flex; justify-content: space-between; align-items: center;
        }
        .status { width: 12px; height: 12px; border-radius: 50%; background: var(--success); }
        .status.off { background: var(--error); }
        .messages {
            flex: 1; overflow-y: auto; padding: 1rem;
            display: flex; flex-direction: column; gap: 1rem;
        }
        .msg { display: flex; gap: 0.5rem; }
        .msg.user { flex-direction: row-reverse; }
        .avatar {
            width: 36px; height: 36px; border-radius: 50%;
            background: var(--primary); display: flex;
            align-items: center; justify-content: center;
        }
        .content {
            max-width: 75%; background: var(--surface);
            padding: 0.75rem; border-radius: 1rem; line-height: 1.5;
        }
        .msg.user .content { background: var(--primary); }
        .input-area {
            background: var(--surface); padding: 1rem;
            display: flex; gap: 0.5rem;
        }
        #input {
            flex: 1; padding: 0.75rem; background: var(--bg);
            border: 2px solid #334155; border-radius: 1.5rem;
            color: var(--text); font-size: 1rem;
        }
        #sendBtn {
            width: 48px; height: 48px; border-radius: 50%;
            background: var(--primary); border: none;
            color: white; font-size: 1.25rem; cursor: pointer;
        }
        #sendBtn:disabled { opacity: 0.5; }
    </style>
</head>
<body>
    <div class="header">
        <div style="display:flex;align-items:center;gap:0.5rem">
            <span class="status" id="status"></span>
            <h1 style="font-size:1.25rem">Abby</h1>
        </div>
    </div>
    <div class="messages" id="msgs">
        <div class="msg">
            <div class="avatar">A</div>
            <div class="content">ðŸ‘‹ Hi! I'm Abby. How can I help?</div>
        </div>
    </div>
    <div class="input-area">
        <input id="input" placeholder="Type a message...">
        <button id="sendBtn" onclick="send()">ðŸ“¤</button>
    </div>
    <script>
        let busy = false;
        setInterval(async () => {
            try {
                const r = await fetch('/api/health');
                document.getElementById('status').className = 'status' + ((await r.json()).status === 'healthy' ? '' : ' off');
            } catch { document.getElementById('status').className = 'status off'; }
        }, 10000);
        
        function add(txt, user=false) {
            const d = document.createElement('div');
            d.className = 'msg' + (user ? ' user' : '');
            d.innerHTML = `<div class="avatar">${user?'U':'A'}</div><div class="content">${txt}</div>`;
            document.getElementById('msgs').appendChild(d);
            d.scrollIntoView({behavior:'smooth'});
        }
        
        async function send() {
            if (busy) return;
            const inp = document.getElementById('input');
            const txt = inp.value.trim();
            if (!txt) return;
            
            add(txt, true);
            inp.value = '';
            busy = true;
            document.getElementById('sendBtn').disabled = true;
            add('â³ Processing...');
            
            try {
                const r = await fetch('/api/task', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify({task: txt})
                });
                const res = await r.json();
                document.getElementById('msgs').lastChild.remove();
                add(res.output || res.error || 'Done!');
            } catch(e) {
                document.getElementById('msgs').lastChild.remove();
                add('âŒ Error: ' + e.message);
            } finally {
                busy = false;
                document.getElementById('sendBtn').disabled = false;
            }
        }
        
        document.getElementById('input').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') send();
        });
    </script>
</body>
</html>
